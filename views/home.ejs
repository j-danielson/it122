<html>
<head>
    <title>Albums</title>
</head>
<body>

<div id="root"></div>

<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

<!-- Don't use this in production: -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
  const albumsData = <%- JSON.stringify(albums) %>;

  const Albums = (props) => {
    return (
      <div>
        <h2>Albums:</h2>
        <ul>
        {props.albums.map((album, index) => (
          <li key={index} onClick={props.clickHandler}>{album.title}</li>
        ))}
        </ul>
      </div>
    )
  }

  const Details = (props) => {
    return (
      <div>
        <h3>Album Details</h3>
        { props.album && 
          <form>
            <b>Title</b>: <input type="text" name="title" onChange={props.changeHandler} value={props.album.title || ''} />
            <b>Title</b>: <input type="text" name="artist" onChange={props.changeHandler} value={props.album.artist || ''} />
            <b>Title</b>: <input type="text" name="release" onChange={props.changeHandler} value={props.album.release || ''} />
            <b>Title</b>: <input type="text" name="genre" onChange={props.changeHandler} value={props.album.genre || ''} />
          </form>

        }
      </div>
    )
  }

  const App = () => {
    const [albums, setAlbums] = React.useState(albumsData);
    const [selectedAlbum, setSelectedAlbum] = React.useState();

    const itemClicked = (e) => {
      let found = albumsData.find((album) => {return album.title === e.target.innerText });
      setSelectedAlbum(found);
    }

    const albumChanged = (e) => {
      let field = e.target.name;
      console.log(';field:', field)
      let newAlbum = {...selectedAlbum};
      console.log('newAlbum[field]', newAlbum[field])
      newAlbum[field] = e.target.value;
      setSelectedAlbum(newAlbum);
      const albumIndex = albums.findIndex((album) => album._id === newAlbum._id);
      const updatedAlbums = [...albums];
      updatedAlbums[albumIndex] = newAlbum;
      setAlbums(updatedAlbums);
    }
    
 
    return (
      <div>
      <Albums albums={albums} clickHandler={itemClicked} />
      <hr />
      <Details album={selectedAlbum} changeHandler={albumChanged} />
      </div>
    );
  }

  ReactDOM.render(<App />, document.getElementById('root'));
</script>


</body>
</html>